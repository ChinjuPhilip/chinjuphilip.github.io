
let stateData = {
    "Peoria":{"2018":{"Dead":0, "Injured":0},"2019":{"Dead":0, "Injured":0},
"2020":{"Dead":0, "Injured":0},"2021" : {"Dead":0, "Injured":0},
"2022" : {"Dead":0, "Injured":0}},
    "Wyoming":{"2018":{"Dead":0, "Injured":0},"2019":{"Dead":0, "Injured":0},
"2020":{"Dead":0, "Injured":0},"2021" : {"Dead":0, "Injured":0},
"2022" : {"Dead":0, "Injured":0}},
    "Maine":{"2018":{"Dead":0, "Injured":0},"2019":{"Dead":0, "Injured":0},
"2020":{"Dead":0, "Injured":0},"2021" : {"Dead":0, "Injured":0},
"2022" : {"Dead":0, "Injured":0}},
    "New Hampshire": {"2018":{"Dead":0, "Injured":0},"2019":{"Dead":0, "Injured":0},
"2020":{"Dead":0, "Injured":0},"2021" : {"Dead":0, "Injured":0},
"2022" : {"Dead":0, "Injured":0}},
    "Washington": {"2018":{"Dead":0, "Injured":0},"2019":{"Dead":0, "Injured":0},
"2020":{"Dead":0, "Injured":0},"2021" : {"Dead":0, "Injured":0},
"2022" : {"Dead":0, "Injured":0}},
    "Illinois": {"2018":{"Dead":0, "Injured":0},"2019":{"Dead":0, "Injured":0},
"2020":{"Dead":0, "Injured":0},"2021" : {"Dead":0, "Injured":0},
"2022" : {"Dead":0, "Injured":0}},
    "Iowa": {"2018":{"Dead":0, "Injured":0},"2019":{"Dead":0, "Injured":0},
"2020":{"Dead":0, "Injured":0},"2021" : {"Dead":0, "Injured":0},
"2022" : {"Dead":0, "Injured":0}},
    "California": {"2018":{"Dead":0, "Injured":0},"2019":{"Dead":0, "Injured":0},
"2020":{"Dead":0, "Injured":0},"2021" : {"Dead":0, "Injured":0},
"2022" : {"Dead":0, "Injured":0}},
    "Nebraska": {"2018":{"Dead":0, "Injured":0},"2019":{"Dead":0, "Injured":0},
"2020":{"Dead":0, "Injured":0},"2021" : {"Dead":0, "Injured":0},
"2022" : {"Dead":0, "Injured":0}},
    "Georgia": {"2018":{"Dead":0, "Injured":0},"2019":{"Dead":0, "Injured":0},
"2020":{"Dead":0, "Injured":0},"2021" : {"Dead":0, "Injured":0},
"2022" : {"Dead":0, "Injured":0}},
    "Colorado": {"2018":{"Dead":0, "Injured":0},"2019":{"Dead":0, "Injured":0},
"2020":{"Dead":0, "Injured":0},"2021" : {"Dead":0, "Injured":0},
"2022" : {"Dead":0, "Injured":0}},
    "Michigan": {"2018":{"Dead":0, "Injured":0},"2019":{"Dead":0, "Injured":0},
"2020":{"Dead":0, "Injured":0},"2021" : {"Dead":0, "Injured":0},
"2022" : {"Dead":0, "Injured":0}},
    "Nevada": {"2018":{"Dead":0, "Injured":0},"2019":{"Dead":0, "Injured":0},
"2020":{"Dead":0, "Injured":0},"2021" : {"Dead":0, "Injured":0},
"2022" : {"Dead":0, "Injured":0}},
    "New Jersey": {"2018":{"Dead":0, "Injured":0},"2019":{"Dead":0, "Injured":0},
"2020":{"Dead":0, "Injured":0},"2021" : {"Dead":0, "Injured":0},
"2022" : {"Dead":0, "Injured":0}},
    "Indiana": {"2018":{"Dead":0, "Injured":0},"2019":{"Dead":0, "Injured":0},
"2020":{"Dead":0, "Injured":0},"2021" : {"Dead":0, "Injured":0},
"2022" : {"Dead":0, "Injured":0}},
    "New York": {"2018":{"Dead":0, "Injured":0},"2019":{"Dead":0, "Injured":0},
"2020":{"Dead":0, "Injured":0},"2021" : {"Dead":0, "Injured":0},
"2022" : {"Dead":0, "Injured":0}},
    "Washington D.C.": {"2018":{"Dead":0, "Injured":0},"2019":{"Dead":0, "Injured":0},
"2020":{"Dead":0, "Injured":0},"2021" : {"Dead":0, "Injured":0},
"2022" : {"Dead":0, "Injured":0}},
    "Texas": {"2018":{"Dead":0, "Injured":0},"2019":{"Dead":0, "Injured":0},
"2020":{"Dead":0, "Injured":0},"2021" : {"Dead":0, "Injured":0},
"2022" : {"Dead":0, "Injured":0}},
    "Santa Ana": {"2018":{"Dead":0, "Injured":0},"2019":{"Dead":0, "Injured":0},
"2020":{"Dead":0, "Injured":0},"2021" : {"Dead":0, "Injured":0},
"2022" : {"Dead":0, "Injured":0}},
    "Ohio": {"2018":{"Dead":0, "Injured":0},"2019":{"Dead":0, "Injured":0},
"2020":{"Dead":0, "Injured":0},"2021" : {"Dead":0, "Injured":0},
"2022" : {"Dead":0, "Injured":0}},
    "Louisiana": {"2018":{"Dead":0, "Injured":0},"2019":{"Dead":0, "Injured":0},
"2020":{"Dead":0, "Injured":0},"2021" : {"Dead":0, "Injured":0},
"2022" : {"Dead":0, "Injured":0}},
    "Pennsylvania": {"2018":{"Dead":0, "Injured":0},"2019":{"Dead":0, "Injured":0},
"2020":{"Dead":0, "Injured":0},"2021" : {"Dead":0, "Injured":0},
"2022" : {"Dead":0, "Injured":0}},
    "South Carolina": {"2018":{"Dead":0, "Injured":0},"2019":{"Dead":0, "Injured":0},
"2020":{"Dead":0, "Injured":0},"2021" : {"Dead":0, "Injured":0},
"2022" : {"Dead":0, "Injured":0}},
    "Minnesota": {"2018":{"Dead":0, "Injured":0},"2019":{"Dead":0, "Injured":0},
"2020":{"Dead":0, "Injured":0},"2021" : {"Dead":0, "Injured":0},
"2022" : {"Dead":0, "Injured":0}},
    "Massachusetts": {"2018":{"Dead":0, "Injured":0},"2019":{"Dead":0, "Injured":0},
"2020":{"Dead":0, "Injured":0},"2021" : {"Dead":0, "Injured":0},
"2022" : {"Dead":0, "Injured":0}},
    "Tennessee": {"2018":{"Dead":0, "Injured":0},"2019":{"Dead":0, "Injured":0},
"2020":{"Dead":0, "Injured":0},"2021" : {"Dead":0, "Injured":0},
"2022" : {"Dead":0, "Injured":0}},
    "Mississippi": {"2018":{"Dead":0, "Injured":0},"2019":{"Dead":0, "Injured":0},
"2020":{"Dead":0, "Injured":0},"2021" : {"Dead":0, "Injured":0},
"2022" : {"Dead":0, "Injured":0}},
    "Missouri": {"2018":{"Dead":0, "Injured":0},"2019":{"Dead":0, "Injured":0},
"2020":{"Dead":0, "Injured":0},"2021" : {"Dead":0, "Injured":0},
"2022" : {"Dead":0, "Injured":0}},
    "Alabama": {"2018":{"Dead":0, "Injured":0},"2019":{"Dead":0, "Injured":0},
"2020":{"Dead":0, "Injured":0},"2021" : {"Dead":0, "Injured":0},
"2022" : {"Dead":0, "Injured":0}},
    "North Carolina": {"2018":{"Dead":0, "Injured":0},"2019":{"Dead":0, "Injured":0},
"2020":{"Dead":0, "Injured":0},"2021" : {"Dead":0, "Injured":0},
"2022" : {"Dead":0, "Injured":0}},
    "Florida": {"2018":{"Dead":0, "Injured":0},"2019":{"Dead":0, "Injured":0},
"2020":{"Dead":0, "Injured":0},"2021" : {"Dead":0, "Injured":0},
"2022" : {"Dead":0, "Injured":0}},
    "Virginia": {"2018":{"Dead":0, "Injured":0},"2019":{"Dead":0, "Injured":0},
"2020":{"Dead":0, "Injured":0},"2021" : {"Dead":0, "Injured":0},
"2022" : {"Dead":0, "Injured":0}},
    "Wisconsin": {"2018":{"Dead":0, "Injured":0},"2019":{"Dead":0, "Injured":0},
"2020":{"Dead":0, "Injured":0},"2021" : {"Dead":0, "Injured":0},
"2022" : {"Dead":0, "Injured":0}},
    "Arizona": {"2018":{"Dead":0, "Injured":0},"2019":{"Dead":0, "Injured":0},
"2020":{"Dead":0, "Injured":0},"2021" : {"Dead":0, "Injured":0},
"2022" : {"Dead":0, "Injured":0}},
    "Kentucky": {"2018":{"Dead":0, "Injured":0},"2019":{"Dead":0, "Injured":0},
"2020":{"Dead":0, "Injured":0},"2021" : {"Dead":0, "Injured":0},
"2022" : {"Dead":0, "Injured":0}},
    "Maryl": {"2018":{"Dead":0, "Injured":0},"2019":{"Dead":0, "Injured":0},
"2020":{"Dead":0, "Injured":0},"2021" : {"Dead":0, "Injured":0},
"2022" : {"Dead":0, "Injured":0}},
    "Utah": {"2018":{"Dead":0, "Injured":0},"2019":{"Dead":0, "Injured":0},
"2020":{"Dead":0, "Injured":0},"2021" : {"Dead":0, "Injured":0},
"2022" : {"Dead":0, "Injured":0}},
    "West Virginia": {"2018":{"Dead":0, "Injured":0},"2019":{"Dead":0, "Injured":0},
"2020":{"Dead":0, "Injured":0},"2021" : {"Dead":0, "Injured":0},
"2022" : {"Dead":0, "Injured":0}},
    "Oklahoma": {"2018":{"Dead":0, "Injured":0},"2019":{"Dead":0, "Injured":0},
"2020":{"Dead":0, "Injured":0},"2021" : {"Dead":0, "Injured":0},
"2022" : {"Dead":0, "Injured":0}},
    "Puerto Rico": {"2018":{"Dead":0, "Injured":0},"2019":{"Dead":0, "Injured":0},
"2020":{"Dead":0, "Injured":0},"2021" : {"Dead":0, "Injured":0},
"2022" : {"Dead":0, "Injured":0}},
    "Arkansas": {"2018":{"Dead":0, "Injured":0},"2019":{"Dead":0, "Injured":0},
"2020":{"Dead":0, "Injured":0},"2021" : {"Dead":0, "Injured":0},
"2022" : {"Dead":0, "Injured":0}},
    "Oregon": {"2018":{"Dead":0, "Injured":0},"2019":{"Dead":0, "Injured":0},
"2020":{"Dead":0, "Injured":0},"2021" : {"Dead":0, "Injured":0},
"2022" : {"Dead":0, "Injured":0}},
    "Kansas": {"2018":{"Dead":0, "Injured":0},"2019":{"Dead":0, "Injured":0},
"2020":{"Dead":0, "Injured":0},"2021" : {"Dead":0, "Injured":0},
"2022" : {"Dead":0, "Injured":0}},
    "Connecticut": {"2018":{"Dead":0, "Injured":0},"2019":{"Dead":0, "Injured":0},
"2020":{"Dead":0, "Injured":0},"2021" : {"Dead":0, "Injured":0},
"2022" : {"Dead":0, "Injured":0}},
    "Hawaii": {"2018":{"Dead":0, "Injured":0},"2019":{"Dead":0, "Injured":0},
"2020":{"Dead":0, "Injured":0},"2021" : {"Dead":0, "Injured":0},
"2022" : {"Dead":0, "Injured":0}},
    "New Mexico": {"2018":{"Dead":0, "Injured":0},"2019":{"Dead":0, "Injured":0},
"2020":{"Dead":0, "Injured":0},"2021" : {"Dead":0, "Injured":0},
"2022" : {"Dead":0, "Injured":0}},
    "United States Virgin Isls": {"2018":{"Dead":0, "Injured":0},"2019":{"Dead":0, "Injured":0},
"2020":{"Dead":0, "Injured":0},"2021" : {"Dead":0, "Injured":0},
"2022" : {"Dead":0, "Injured":0}},
    "South Dakota": {"2018":{"Dead":0, "Injured":0},"2019":{"Dead":0, "Injured":0},
"2020":{"Dead":0, "Injured":0},"2021" : {"Dead":0, "Injured":0},
"2022" : {"Dead":0, "Injured":0}},
    "Idaho": {"2018":{"Dead":0, "Injured":0},"2019":{"Dead":0, "Injured":0},
"2020":{"Dead":0, "Injured":0},"2021" : {"Dead":0, "Injured":0},
"2022" : {"Dead":0, "Injured":0}},
    "Delaware": {"2018":{"Dead":0, "Injured":0},"2019":{"Dead":0, "Injured":0},
"2020":{"Dead":0, "Injured":0},"2021" : {"Dead":0, "Injured":0},
"2022" : {"Dead":0, "Injured":0}},
    "Rhode Isl": {"2018":{"Dead":0, "Injured":0},"2019":{"Dead":0, "Injured":0},
"2020":{"Dead":0, "Injured":0},"2021" : {"Dead":0, "Injured":0},
"2022" : {"Dead":0, "Injured":0}},
    "Alaska": {"2018":{"Dead":0, "Injured":0},"2019":{"Dead":0, "Injured":0},
"2020":{"Dead":0, "Injured":0},"2021" : {"Dead":0, "Injured":0},
"2022" : {"Dead":0, "Injured":0}},
    "Montana": {"2018":{"Dead":0, "Injured":0},"2019":{"Dead":0, "Injured":0},
"2020":{"Dead":0, "Injured":0},"2021" : {"Dead":0, "Injured":0},
"2022" : {"Dead":0, "Injured":0}},
    "District of Columbia": {"2018":{"Dead":0, "Injured":0},"2019":{"Dead":0, "Injured":0},
"2020":{"Dead":0, "Injured":0},"2021" : {"Dead":0, "Injured":0},
"2022" : {"Dead":0, "Injured":0}},    
}
let months = ["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]
let monthData= {
    "Jan" : {"2018":{"Dead":0, "Injured":0},"2019":{"Dead":0, "Injured":0},
"2020":{"Dead":0, "Injured":0},"2021" : {"Dead":0, "Injured":0},
"2022" : {"Dead":0, "Injured":0}},
    "Feb" : {"2018":{"Dead":0, "Injured":0},"2019":{"Dead":0, "Injured":0},
"2020":{"Dead":0, "Injured":0},"2021" : {"Dead":0, "Injured":0},
"2022" : {"Dead":0, "Injured":0}},
    "Mar" : {"2018":{"Dead":0, "Injured":0},"2019":{"Dead":0, "Injured":0},
"2020":{"Dead":0, "Injured":0},"2021" : {"Dead":0, "Injured":0},
"2022" : {"Dead":0, "Injured":0}},
    "Apr" : {"2018":{"Dead":0, "Injured":0},"2019":{"Dead":0, "Injured":0},
"2020":{"Dead":0, "Injured":0},"2021" : {"Dead":0, "Injured":0},
"2022" : {"Dead":0, "Injured":0}},
    "May" : {"2018":{"Dead":0, "Injured":0},"2019":{"Dead":0, "Injured":0},
"2020":{"Dead":0, "Injured":0},"2021" : {"Dead":0, "Injured":0},
"2022" : {"Dead":0, "Injured":0}},
    "Jun" : {"2018":{"Dead":0, "Injured":0},"2019":{"Dead":0, "Injured":0},
"2020":{"Dead":0, "Injured":0},"2021" : {"Dead":0, "Injured":0},
"2022" : {"Dead":0, "Injured":0}},
    "Jul" : {"2018":{"Dead":0, "Injured":0},"2019":{"Dead":0, "Injured":0},
"2020":{"Dead":0, "Injured":0},"2021" : {"Dead":0, "Injured":0},
"2022" : {"Dead":0, "Injured":0}},
    "Aug" : {"2018":{"Dead":0, "Injured":0},"2019":{"Dead":0, "Injured":0},
"2020":{"Dead":0, "Injured":0},"2021" : {"Dead":0, "Injured":0},
"2022" : {"Dead":0, "Injured":0}},
    "Sep" : {"2018":{"Dead":0, "Injured":0},"2019":{"Dead":0, "Injured":0},
"2020":{"Dead":0, "Injured":0},"2021" : {"Dead":0, "Injured":0},
"2022" : {"Dead":0, "Injured":0}},
    "Oct" : {"2018":{"Dead":0, "Injured":0},"2019":{"Dead":0, "Injured":0},
"2020":{"Dead":0, "Injured":0},"2021" : {"Dead":0, "Injured":0},
"2022" : {"Dead":0, "Injured":0}},
    "Nov" : {"2018":{"Dead":0, "Injured":0},"2019":{"Dead":0, "Injured":0},
"2020":{"Dead":0, "Injured":0},"2021" : {"Dead":0, "Injured":0},
"2022" : {"Dead":0, "Injured":0}},
    "Dec" : {"2018":{"Dead":0, "Injured":0},"2019":{"Dead":0, "Injured":0},
"2020":{"Dead":0, "Injured":0},"2021" : {"Dead":0, "Injured":0},
"2022" : {"Dead":0, "Injured":0}}
}

let stateDeadMax = 0;
let monthDeadMax = 0;

let stateInjuredMax = 0;
let monthInjuredMax = 0;

let height = 450;
let width = 450;
let margin = 40;

let selectedMonth = 0;
let selectedYear = "2022";

let currentScene=1;
const totalScenes = 4;

function selectYear(value){
    selectedYear = String(value);
    const yearRender = document.getElementById("_yearValue");
    yearRender.innerHTML = selectedYear;
    renderGraph();
}

function navigateButtonClicked()
{
    if(currentScene == totalScenes)
        document.getElementById("next").classList.add("display-none");
    else
        document.getElementById("next").classList.remove("display-none");
    
    if(currentScene == 1)
        document.getElementById("prev").classList.add("display-none");
    else
        document.getElementById("prev").classList.remove("display-none");
}

function nextScene(){
    currentScene=Math.min(currentScene+1, totalScenes);
    navigateButtonClicked();    
    renderGraph()
}

function prevScene(){
    currentScene=Math.max(currentScene-1, 1);
    navigateButtonClicked();    
    renderGraph()
}

function preProcessData (data) {
    
    data.forEach(function (row, index){
        let dateData = data[index].Date.split('-');
        let month = dateData[1];
        let year = String(dateData[0]);

        let state = data[index].State        
        stateData[state][year]["Dead"] += parseInt(data[index].Dead)
        if(stateData[state][year]["Dead"]>stateDeadMax)
            stateDeadMax = stateData[state][year]["Dead"]

        stateData[state][year]["Injured"] += parseInt(data[index].Injured)
        if(stateData[state][year]["Injured"] > stateInjuredMax)
            stateInjuredMax = stateData[state][year]["Injured"]
        

        monthData[months[month-1]][year]["Dead"] += parseInt(data[index].Dead)
        if(monthData[months[month-1]][year]["Dead"] > monthDeadMax)
            monthDeadMax = monthData[months[month-1]][year]["Dead"]

        monthData[months[month-1]][year]["Injured"] += parseInt(data[index].Injured)
        if(monthData[months[month-1]][year]["Injured"] > monthInjuredMax)
            monthInjuredMax = monthData[months[month-1]][year]["Injured"]
        
    })
}

function clearGraph(){
    d3.select("svg").selectAll("*").remove();
}

function renderPage(){
    d3.select(".centre-content")
    .select("h1")
    .text(scene_data[currentScene-1].title);

    d3.select(".centre-content")
    .select(".scene-short")
    .text(scene_data[currentScene-1].short);    

    d3.select(".centre-content")
    .select(".scene-desc")
    .text(scene_data[currentScene-1].description);
}

function renderGraph(){
    clearGraph();
    renderPage();
    if(currentScene == 5)
        document.getElementById("states").classList.remove("display-none");
    else
        document.getElementById("states").classList.add("display-none");

    if(currentScene == 1)
        renderScene1();
    else if(currentScene == 2)
        renderScene2();
    else if(currentScene == 3)
        renderScene3();
    else if(currentScene == 4)
        renderScene4();
    else if(currentScene == 5)
        renderScene5();

    
}

d3.csv("dataset.csv")
    .then( async function (data){        
        preProcessData(data)        
        renderScene1(); 
        renderPage()
})

